name: PHPUnit Tests via Composer

on: [push, pull_request]

jobs:
  build:
    name: Build and test
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v1
    - name: Validate composer.json and composer.lock
      run: composer validate
    - name: Install dependencies
      run: composer install --prefer-dist --no-progress --no-suggest
#    - name: Run test suite
#      run: composer run-script test
    - name: Unit tests
      run: phpunit --coverage-text
    - name: Psalm
      run: ./vendor/bin/psalm
    - name: phpstan
      run: ./vendor/bin/phpstan analyse
    - name: Mess Detector
      run: ./vendor/bin/phpmd src text codesize,design,naming
